name: WCAG tests

on:
  pull_request

jobs:
  call_wcag_test:
    uses: yext/slapshot-reusable-workflows/.github/workflows/wcag_test.yml@v1
    secrets:
      NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
    with:
      build_script: |
        npm run storybook &
        attempt_counter=0
        max_attempts=5
        until curl http://localhost:6006 -I
        do
          if [ ${attempt_counter} -eq ${max_attempts} ]
          then
            echo "Max attempts reached. Failed to start Storybook."
            exit 1
          fi
          attempt_counter=$(($attempt_counter+1))
          echo ${attempt_counter}
          sleep 1
        done
